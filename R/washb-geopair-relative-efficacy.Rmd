---
title: "Relative efficiency of geographic pair matching in the WASH Benefits trials"
subtitle: ""
author: "Ben Arnold ben.arnold@ucsf.edu"
date: "updated: `r Sys.time()`"
output: 
  html_document:
    theme: default
    highlight: haddock
    code_folding: hide
    toc: true
    toc_depth: 3
    toc_float:
      collapsed: true
      smooth_scroll: true
---

# Summary

Summary here: **TBD**

Details of original citations and data sources here: **TBD**


# Preamble

```{r preamble}
library(here)
here()
#----------------------------
# source the config file
#----------------------------
source(here("R","washb-geopair-Config.R"))

```



# Bangladesh

## Data prep

```{r load bangladesh data}
#-------------------------------
# load the formatted analysis
# data created by
# washb-geopair-data-processing.R
#-------------------------------

# anthropometry data
danth <- read_rds(here("data","bangl_analysis_anthro.rds")) %>%
  mutate(blockf = factor(block))

# child development data
dchdev <- read_rds(here("data","bangl_analysis_chdev.rds")) %>%
  mutate(blockf = factor(block))

# diarrhea data
ddiar <- read_rds(here("data","bangl_analysis_diar.rds")) %>%
  mutate(blockf = factor(block))

# giardia data
dpara <- read_rds(here("data","bangl_analysis_parasite.rds")) %>%
  mutate(blockf = factor(block))

```

```{r bangladesh cluster level means, warning = FALSE, error = FALSE}
#-------------------------------
# calculate geographic pair-matched
# group means - anthropometry
#-------------------------------
danth_cl <- danth %>%
  select(-dataid,-childid,-tchild,-clusterid) %>%
  group_by(block,tr) %>%
  summarize_all(function(x) mean(x,na.rm=TRUE))

#-------------------------------
# calculate geographic pair-matched
# group means - EASQ communication
#-------------------------------
dcom_cl <- dchdev %>%
  select(block,tr,z_easq_com) %>%
  group_by(block,tr) %>%
  summarize_all(function(x) mean(x,na.rm=TRUE))

#-------------------------------
# calculate geographic pair-matched
# group means - EASQ motor
#-------------------------------
dmot_cl <- dchdev %>%
  select(block,tr,z_easq_motor) %>%
  group_by(block,tr) %>%
  summarize_all(function(x) mean(x,na.rm=TRUE))

#-------------------------------
# calculate geographic pair-matched
# group means - EASQ personal-social
#-------------------------------
dps_cl <- dchdev %>%
  select(block,tr,z_easq_pers) %>%
  group_by(block,tr) %>%
  summarize_all(function(x) mean(x,na.rm=TRUE))

#-------------------------------
# calculate geographic pair-matched
# group means - CDI comprehension
#-------------------------------
dcdicomp_cl <- dchdev %>%
  select(block,tr,z_cdi_comp) %>%
  group_by(block,tr) %>%
  summarize_all(function(x) mean(x,na.rm=TRUE))


#-------------------------------
# calculate geographic pair-matched
# group means - CDI expression
#-------------------------------
dcdiexpr_cl <- dchdev %>%
  select(block,tr,z_cdi_expr) %>%
  group_by(block,tr) %>%
  summarize_all(function(x) mean(x,na.rm=TRUE))


#-------------------------------
# calculate geographic pair-matched
# group means - diarrhea
#-------------------------------
ddiar_cl <- ddiar %>%
  select(-dataid,-childid,-tchild,-clusterid) %>%
  filter(!is.na(diar7d)) %>%
  group_by(block,tr) %>%
  mutate(nobs = n(),
         npos = sum(diar7d, na.rm = TRUE)) %>%
  slice(1) %>%
  # if there were no diarrhea cases in the pair-treatment arm, 
  # then add 0.5 to avoid -Inf with a log transformation
  mutate(diarprev = ifelse(npos>0,npos/nobs,0.5/nobs)) %>%
  mutate(logdiarprev = log(diarprev))


#-------------------------------
# calculate geographic pair-matched
# group means - giardia
#-------------------------------
dgiar_cl <- dpara %>% 
  select(block,tr,giar) %>%
  filter(!is.na(giar)) %>%
  group_by(block,tr) %>%
  mutate(nobs = n(),
         npos = sum(giar, na.rm = TRUE)) %>%
  slice(1) %>%
  mutate(giarprev = npos/nobs) 

#-------------------------------
# calculate geographic pair-matched
# group means - Ascaris
#-------------------------------
dal_cl <- dpara %>% 
  select(block,tr,al) %>%
  filter(!is.na(al)) %>%
  group_by(block,tr) %>%
  mutate(nobs = n(),
         npos = sum(al, na.rm = TRUE)) %>%
  slice(1) %>%
  mutate(alprev = npos/nobs) 

#-------------------------------
# calculate geographic pair-matched
# group means - trichuris
#-------------------------------
dtt_cl <- dpara %>% 
  select(block,tr,tt) %>%
  filter(!is.na(tt)) %>%
  group_by(block,tr) %>%
  mutate(nobs = n(),
         npos = sum(tt, na.rm = TRUE)) %>%
  slice(1) %>%
  # if there were no trichuris cases in the pair-treatment arm, 
  # then add 0.5 to avoid -Inf with a log transformation
  mutate(ttprev = ifelse(npos>0,npos/nobs,0.5/nobs)) %>%
  mutate(logttprev = log(ttprev))

#-------------------------------
# calculate geographic pair-matched
# group means - hookworm
#-------------------------------
dhw_cl <- dpara %>% 
  select(block,tr,hw) %>%
  filter(!is.na(hw)) %>%
  group_by(block,tr) %>%
  mutate(nobs = n(),
         npos = sum(hw, na.rm = TRUE)) %>%
  slice(1) %>%
  # if there were no hookworm cases in the pair-treatment arm, 
  # then add 0.5 to avoid -Inf with a log transformation
  mutate(hwprev = ifelse(npos>0,npos/nobs,0.5/nobs)) %>%
  mutate(loghwprev = log(hwprev))

```

## Pairwise correlation 

For each outcome, estimate the correlation between paired means.

For more rare binary outcomes (diarrhea, trichuris, hookworm), use log-transformed outcomes because they are skewed. This ensures the distribution is symmetric, and means that we are testing for differences in the prevalence ratio (difference in log prevalences).  For more common binary outcomes (giardia, ascaris) use their untransformed prevalence values.

```{r bangladesh pairwise correlation}
#-------------------------------
# LAZ
#-------------------------------
b_block_laz <- danth_cl %>%
  select(block,tr,laz) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = laz)
b_cor_laz <- cor(b_block_laz$Control,b_block_laz$Nutrition)


#-------------------------------
# WAZ
#-------------------------------
b_block_waz <- danth_cl %>%
  select(block,tr,waz) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = waz)
b_cor_waz <- cor(b_block_waz$Control,b_block_waz$Nutrition)


#-------------------------------
# WHZ
#-------------------------------
b_block_whz <- danth_cl %>%
  select(block,tr,whz) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = whz)
b_cor_whz <- cor(b_block_whz$Control,b_block_whz$Nutrition)


#-------------------------------
# HCZ
#-------------------------------
b_block_hcz <- danth_cl %>%
  select(block,tr,hcz) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = hcz)
b_cor_hcz <- cor(b_block_hcz$Control,b_block_hcz$Nutrition)

#-------------------------------
# EASQ Communication
#-------------------------------
b_block_com <- dcom_cl %>%
  select(block,tr,z_easq_com) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = z_easq_com)
b_cor_com <- cor(b_block_com$Control,b_block_com$Nutrition)

#-------------------------------
# EASQ Gross motor
#-------------------------------
b_block_mot <- dmot_cl %>%
  select(block,tr,z_easq_motor) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = z_easq_motor)
b_cor_mot <- cor(b_block_mot$Control,b_block_mot$Nutrition)

#-------------------------------
# EASQ Personal-social
#-------------------------------
b_block_ps <- dps_cl %>%
  select(block,tr,z_easq_pers) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = z_easq_pers)
b_cor_ps <- cor(b_block_ps$Control,b_block_ps$Nutrition)

#-------------------------------
# CDI comprehension
#-------------------------------
b_block_cdicomp <- dcdicomp_cl %>%
  select(block,tr,z_cdi_comp) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = z_cdi_comp)
b_cor_cdicomp <- cor(b_block_cdicomp$Control,b_block_cdicomp$Nutrition)

#-------------------------------
# CDI expression
#-------------------------------
b_block_cdiexpr <- dcdiexpr_cl %>%
  select(block,tr,z_cdi_expr) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = z_cdi_expr)
b_cor_cdiexpr <- cor(b_block_cdiexpr$Control,b_block_cdiexpr$Nutrition)


#-------------------------------
# Diarrhea
#-------------------------------
b_block_diar <- ddiar_cl %>%
  select(block,tr,logdiarprev) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = logdiarprev)
b_cor_diar <- cor(b_block_diar$Control,b_block_diar$Nutrition)

#-------------------------------
# Giardia
#-------------------------------
b_block_giar <- dgiar_cl %>%
  select(block,tr,giarprev) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = giarprev)
b_cor_giar <- cor(b_block_giar$Control,b_block_giar$Nutrition)

#-------------------------------
# Ascaris
#-------------------------------
b_block_al <- dal_cl %>%
  select(block,tr,alprev) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = alprev)
b_cor_al <- cor(b_block_al$Control,b_block_al$Nutrition)

#-------------------------------
# Trichuris
#-------------------------------
b_block_tt <- dtt_cl %>%
  select(block,tr,logttprev) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = logttprev)
b_cor_tt <- cor(b_block_tt$Control,b_block_tt$Nutrition)

#-------------------------------
# Hookworm
#-------------------------------
b_block_hw <- dhw_cl %>%
  select(block,tr,loghwprev) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = loghwprev)
b_cor_hw <- cor(b_block_hw$Control,b_block_hw$Nutrition)

```

# Kenya

## Data prep

```{r load Kenya data}
#-------------------------------
# load the formatted analysis
# data created by
# washb-geopair-data-processing.R
#-------------------------------

# anthropometry data
dkanth <- read_rds(here("data","kenya_analysis_anthro.rds")) %>%
  mutate(blockf = factor(block))

# diarrhea data
dkdiar <- read_rds(here("data","kenya_analysis_diar.rds")) %>%
  mutate(blockf = factor(block))

# parasite data
dkpara <- read_rds(here("data","kenya_analysis_parasite.rds")) %>%
  mutate(blockf = factor(block))

# child development data
dkchdev <- read_rds(here("data","kenya_analysis_chdev.rds")) %>%
  mutate(blockf = factor(block))

```



```{r kenya cluster level means, warning = FALSE, error = FALSE}
#-------------------------------
# calculate geographic pair-matched
# group means - anthropometry
#-------------------------------
dkanth_cl <- dkanth %>%
  select(-clusterid,-compoundid,-childid,-targetchild) %>%
  group_by(block,tr) %>%
  summarize_all(function(x) mean(x,na.rm=TRUE))

#-------------------------------
# calculate geographic pair-matched
# group means - diarrhea
#-------------------------------
dkdiar_cl <- dkdiar %>%
  select(-clusterid,-compoundid,-childid,-targetchild) %>%
  filter(!is.na(diarr7)) %>%
  group_by(block,tr) %>%
  mutate(nobs = n(),
         npos = sum(diarr7, na.rm = TRUE)) %>%
  slice(1) %>%
  # if there were no diarrhea cases in the pair-treatment arm, 
  # then add 0.5 to avoid -Inf with a log transformation
  mutate(diarprev = ifelse(npos>0,npos/nobs,0.5/nobs)) %>%
  mutate(logdiarprev = log(diarprev))


#-------------------------------
# calculate geographic pair-matched
# group means - giardia
#-------------------------------
dkgiar_cl <- dkpara %>% 
  select(block,tr,giar) %>%
  filter(!is.na(giar)) %>%
  group_by(block,tr) %>%
  mutate(nobs = n(),
         npos = sum(giar, na.rm = TRUE)) %>%
  slice(1) %>%
  mutate(giarprev = npos/nobs) 

#-------------------------------
# calculate geographic pair-matched
# group means - Ascaris
#-------------------------------
dkal_cl <- dkpara %>% 
  select(block,tr,al) %>%
  filter(!is.na(al)) %>%
  group_by(block,tr) %>%
  mutate(nobs = n(),
         npos = sum(al, na.rm = TRUE)) %>%
  slice(1) %>%
  mutate(alprev = npos/nobs) 

#-------------------------------
# Trichuris was too rare in 
# Kenya for analysis
#-------------------------------

#-------------------------------
# calculate geographic pair-matched
# group means - hookworm
#-------------------------------
dkhw_cl <- dkpara %>% 
  select(block,tr,hw) %>%
  filter(!is.na(hw)) %>%
  group_by(block,tr) %>%
  mutate(nobs = n(),
         npos = sum(hw, na.rm = TRUE)) %>%
  slice(1) %>%
  # if there were no hookworm cases in the pair-treatment arm, 
  # then add 0.5 to avoid -Inf with a log transformation
  mutate(hwprev = ifelse(npos>0,npos/nobs,0.5/nobs)) %>%
  mutate(loghwprev = log(hwprev))


#-------------------------------
# calculate geographic pair-matched
# group means - communication
#-------------------------------
dkcom_cl <- dkchdev %>%
  select(block,tr,z_easq_com) %>%
  filter(!is.na(z_easq_com)) %>%
  group_by(block,tr) %>%
  summarize_all(function(x) mean(x,na.rm=TRUE))

#-------------------------------
# calculate geographic pair-matched
# group means - gross motor
#-------------------------------
dkmot_cl <- dkchdev %>%
  select(block,tr,z_easq_motor) %>%
  filter(!is.na(z_easq_motor)) %>%
  group_by(block,tr) %>%
  summarize_all(function(x) mean(x,na.rm=TRUE))


#-------------------------------
# calculate geographic pair-matched
# group means - personal-social
#-------------------------------
dkps_cl <- dkchdev %>%
  select(block,tr,z_easq_pers) %>%
  filter(!is.na(z_easq_pers)) %>%
  group_by(block,tr) %>%
  summarize_all(function(x) mean(x,na.rm=TRUE))

```

## Pairwise correlation 

For each outcome, estimate the correlation between paired means.

For more rare binary outcomes (hookworm), use log-transformed outcomes because they are skewed. This ensures the distribution is symmetric, and means that we are testing for differences in the prevalence ratio (difference in log prevalences).  For more common binary outcomes (diarrhea, giardia, ascaris) use their untransformed prevalence values.

```{r kenya pairwise correlation}
#-------------------------------
# LAZ
#-------------------------------
k_block_laz <- dkanth_cl %>%
  select(block,tr,laz) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = laz)
k_cor_laz <- cor(k_block_laz$Control,k_block_laz$Nutrition, use = "pairwise")


#-------------------------------
# WAZ
#-------------------------------
k_block_waz <- dkanth_cl %>%
  select(block,tr,waz) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = waz)
k_cor_waz <- cor(k_block_waz$Control,k_block_waz$Nutrition, use = "pairwise")


#-------------------------------
# WHZ
#-------------------------------
k_block_whz <- dkanth_cl %>%
  select(block,tr,whz) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = whz)
k_cor_whz <- cor(k_block_whz$Control,k_block_whz$Nutrition, use = "pairwise")


#-------------------------------
# HCZ
#-------------------------------
k_block_hcz <- dkanth_cl %>%
  select(block,tr,hcz) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = hcz)
k_cor_hcz <- cor(k_block_hcz$Control,k_block_hcz$Nutrition, use = "pairwise")

#-------------------------------
# EASQ Communication
#-------------------------------
k_block_com <- dkcom_cl %>%
  select(block,tr,z_easq_com) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = z_easq_com)
k_cor_com <- cor(k_block_com$Control,k_block_com$Nutrition, use = "pairwise")

#-------------------------------
# EASQ Gross motor
#-------------------------------
k_block_mot <- dkmot_cl %>%
  select(block,tr,z_easq_motor) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = z_easq_motor)
k_cor_mot <- cor(k_block_mot$Control,k_block_mot$Nutrition, use = "pairwise")

#-------------------------------
# EASQ Personal-social
#-------------------------------
k_block_ps <- dkps_cl %>%
  select(block,tr,z_easq_pers) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = z_easq_pers)
k_cor_ps <- cor(k_block_ps$Control,k_block_ps$Nutrition, use = "pairwise")

#-------------------------------
# Diarrhea
#-------------------------------
k_block_diar <- dkdiar_cl %>%
  select(block,tr,diarprev) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = diarprev)
k_cor_diar <- cor(k_block_diar$Control,k_block_diar$Nutrition, use = "pairwise")

#-------------------------------
# Giardia
#-------------------------------
k_block_giar <- dkgiar_cl %>%
  select(block,tr,giarprev) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = giarprev)
k_cor_giar <- cor(k_block_giar$Control,k_block_giar$Nutrition, use = "pairwise")

#-------------------------------
# Ascaris
#-------------------------------
k_block_al <- dkal_cl %>%
  select(block,tr,alprev) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = alprev)
k_cor_al <- cor(k_block_al$Control,k_block_al$Nutrition, use = "pairwise")

#-------------------------------
# Trichuris
# (not estimated in Kenya -- too rare)
#-------------------------------
#-------------------------------
# Hookworm
#-------------------------------
k_block_hw <- dkhw_cl %>%
  select(block,tr,loghwprev) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = loghwprev)
k_cor_hw <- cor(k_block_hw$Control,k_block_hw$Nutrition, use = "pairwise")


```


# Summary Table

```{r summary table}
options(knitr.kable.NA = "‡")

sumtab <- data.frame(
  outcome_group = c(rep("Child growth",4),rep("Child development",5),rep("Infectious disease",5) ),
  outcome = c("Length-for-age z-score","Weight-for-age z-score","Weight-for-height z-score","Head circumference z-score",
              "EASQ Communication z-score","EASQ Gross motor z-score","EASQ Personal-social z-score", "CDI Comprehension z-score","CDI Expression z-score",
              "Diarrhea","Giardia sp.","Ascaris sp.","Trichuris sp.","Hookworm"),
  cor_b = c(b_cor_laz,b_cor_waz,b_cor_whz,b_cor_hcz,
            b_cor_com,b_cor_mot,b_cor_ps,b_cor_cdicomp,b_cor_cdiexpr,
            b_cor_diar,b_cor_giar,b_cor_al,b_cor_tt,b_cor_hw),
  cor_k = c(k_cor_laz,k_cor_waz,k_cor_whz,k_cor_hcz,
            k_cor_com,k_cor_mot,k_cor_ps,NA,NA,
            k_cor_diar,k_cor_giar,k_cor_al,NA,k_cor_hw)
)
sumtab <- sumtab %>%
  mutate(releff_b = 1/(1-cor_b),
         releff_k = 1/(1-cor_k)) %>%
  select(outcome_group,outcome,cor_b,releff_b,cor_k,releff_k)

knitr::kable(sumtab %>% select(-outcome_group),
             digits = c(0,2,1,2,1),
             col.names = c("Outcome","Pair-wise\ncorrelation*","Relative Efficacy†","Pair-wise\ncorrelation*","Relative Efficacy†"),
             caption = "Summary of pair-wise outcome correlation and relative efficacy of geographic pair-matching") %>%
  kable_styling(bootstrap_options = "striped") %>%
  group_rows("Child growth",1,4) %>%
  group_rows("Child development",5,9) %>%
  group_rows("Infectious disease",10,14) %>%
  add_header_above(c(" " = 1, "Bangladesh" = 2, "Kenya" = 2)) %>%
  footnote(symbol = c("Correlation between geographically paired, cluster-level means.",
                      "Relative efficacy of geographic pair-matching compared to an unmatched design, defined as 1/(1-r), where r is the correlation between paired outcomes. A relative efficacy of 1.5 means that a pair-matched study with 100 clusters per group has the same power as an unmatched study with 150 clusters per group.","Trichuris sp. was too rare in Kenya to estimate."))

```

# Summary Figure

```{r plot relative efficiency, warning = FALSE}
# pivot the summary table longer to plot
sumtab2 <- sumtab %>%
  mutate(outcome_lab = c("LAZ","WAZ","WHZ","HCZ","EASQ Communication","EASQ Gross motor","EASQ Personal-social","CDI Comprehension","CDI Expression","Diarrhea","Giardia sp.","Ascaris sp.","Trichuris sp.","Hookworm")
         )
sumtabplot <- sumtab2 %>%
  select(outcome_group, outcome, outcome_lab ,corr = cor_b, releff = releff_b) %>%
  mutate(country = "Bangladesh") %>%
  bind_rows(sumtab2 %>% select(outcome_group, outcome,outcome_lab, corr = cor_k, releff = releff_k)) %>%
  mutate(country = ifelse(is.na(country),"Kenya",country), 
         country = factor(country),
         outcome_group = factor(outcome_group)
         ) %>%
  # tedious x and y nudge coordinates for labels to optimize display
  mutate(lab_xnudge = case_when(
           outcome_lab == "LAZ" ~ 0.015,
           outcome_lab == "WAZ" & country == "Kenya" ~ 0.015,
           outcome_lab %in% c("EASQ Communication","EASQ Personal-social","CDI Expression") & country == "Bangladesh" ~ 0.015,
           TRUE ~ as.numeric(-0.015)
         ),
         lab_ynudge = case_when(
           outcome_lab == "Hookworm" & country == "Bangladesh" ~ 0.03,
           outcome_lab == "EASQ Personal-social" & country == "Bangladesh" ~ -0.02,
           outcome_lab == "EASQ Personal-social" & country == "Kenya" ~ 0.02,
           outcome_lab == "CDI Expression" & country == "Bangladesh" ~ -0.04,
           TRUE ~ as.numeric(0)
         ),
         lab_hjust = ifelse(lab_xnudge < 0 , 1, 0)
         )


# data frame for function
d_reff <- data.frame(rho = seq(0,0.8,by=0.01)) %>%
  mutate(reff = 1/(1-rho))

# make plot
# pcols <- c("gray40",cbpal[c(3,2)])
pcols <- nytpal[c(1,4,7)]
plot_reff <- ggplot(data=sumtabplot, aes(x = corr, y = releff)) +
  # facet over country
  facet_grid(~country) +
  # add function line
  geom_line(data=d_reff,aes(x=rho,y=reff),alpha = 0.4, linetype = "dashed", show.legend = FALSE) +
  # plot results
  # this offset is very idiosyncratic to optimize display -- fragile code!
  geom_text(aes(label = outcome_lab, color = outcome_group), 
            hjust = sumtabplot$lab_hjust, 
            nudge_x = sumtabplot$lab_xnudge,
            nudge_y = sumtabplot$lab_ynudge,
            size = 2.5, show.legend = FALSE) +
  geom_point(aes(color = outcome_group), size = 1.8, alpha=1) + 
  geom_point(pch=21,bg=NA, size=1.8, show.legend = TRUE) +
  # refine aesthetics
  scale_color_manual(values = pcols, guide=guide_legend(title="Outcome group:")) +
  # scale_color_viridis_d(begin = 0, end = 0.6, direction = -1, option = "D",  guide=guide_legend(title="Outcome group:")) +
  scale_y_continuous(breaks=seq(1,2.4,by=0.2))+
  scale_x_continuous(breaks=seq(0,0.6,by=0.1)) +
  coord_cartesian(ylim=c(1,2.4),xlim = c(0,0.6)) +
  labs(x=expression(paste("Correlation between paired outcomes, (",italic(r),")")),y=expression(paste("Relative efficacy of geographic pair-matching, (1-",italic(r),")")^-1)) +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    panel.grid.minor = element_blank()
  )
plot_reff

ggsave(filename = here("output","washb-geopair-relative-efficacy.png"),plot_reff,device = "png", height=4.7,width=7)
```

# Session Info
```{r session info}
sessionInfo()
```


