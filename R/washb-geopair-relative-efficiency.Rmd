---
title: "Relative efficiency of geographic pair matching in the WASH Benefits trials"
subtitle: ""
author: "Ben Arnold ben.arnold@ucsf.edu"
date: "updated: `r Sys.time()`"
output: 
  html_document:
    theme: default
    highlight: haddock
    code_folding: hide
    toc: true
    toc_depth: 3
    toc_float:
      collapsed: true
      smooth_scroll: true
---

# Summary

Summary here: **TBD**

Details of original citations and data sources here: **TBD**


# Preamble

```{r preamble}
library(here)
here()
#----------------------------
# source the config file
#----------------------------
source(here("R","washb-geopair-Config.R"))

```



# Bangladesh

## Anthropometry

```{r load bangladesh anthro data}
#-------------------------------
# load the formatted analysis
# data created by
# washb-geopair-data-processing.R
#-------------------------------
danth <- read_rds(here("data","bangl_analysis_anthro.rds"))

```

```{r bangladesh anthro cluster level means}
#-------------------------------
# calculate geographic pair-matched
# group means
#-------------------------------
danth_cl <- danth %>%
  select(-dataid,-childid,-tchild,-clusterid) %>%
  group_by(block,tr) %>%
  summarize_all(function(x) mean(x,na.rm=TRUE))

```

### Pairwise correlation 

For each anthropometric outcome, estimate the correlation between paired means

```{r bangladesh anthro pairwise correlation}
#-------------------------------
# WAZ
#-------------------------------
b_block_waz <- danth_cl %>%
  select(block,tr,waz) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = waz)
b_cor_waz <- cor(b_block_waz$Control,b_block_waz$Intervention)


#-------------------------------
# LAZ
#-------------------------------
b_block_laz <- danth_cl %>%
  select(block,tr,laz) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = laz)
b_cor_laz <- cor(b_block_laz$Control,b_block_laz$Intervention)


#-------------------------------
# WHZ
#-------------------------------
b_block_whz <- danth_cl %>%
  select(block,tr,whz) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = whz)
b_cor_whz <- cor(b_block_whz$Control,b_block_whz$Intervention)


#-------------------------------
# HCZ
#-------------------------------
b_block_hcz <- danth_cl %>%
  select(block,tr,hcz) %>%
  pivot_wider(id_cols = block, names_from = tr, values_from = hcz)
b_cor_hcz <- cor(b_block_hcz$Control,b_block_hcz$Intervention)


```

# Session Info
```{r session info}
sessionInfo()
```


